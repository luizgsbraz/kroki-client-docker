name: Docker Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    # Faz o login no Docker Hub usando variáveis de ambiente (adicionadas ao GitHub Secrets)
    - name: Log in to Docker Hub
      run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

    # Constrói a imagem com a tag timestamp
    - name: Build the Docker image
      run: |
        TAG=$(date +%s)
        docker build --no-cache . --file Dockerfile --tag luizgsbraz/kroki-client:$TAG
        docker tag luizgsbraz/kroki-client:$TAG luizgsbraz/kroki-client:latest

    # # Faz o push da imagem para o Docker Hub com as duas tags (timestamp e latest)
    # - name: Push the Docker image
    #   run: |
    #     TAG=$(date +%s)
    #     docker push luizgsbraz/kroki-client:$TAG
    #     docker push luizgsbraz/kroki-client:latest
